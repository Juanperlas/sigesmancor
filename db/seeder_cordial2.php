<?php

// ConfiguraciÃ³n de la conexiÃ³n a la base de datos
$host = 'sql207.infinityfree.com';
$dbname = 'if0_38802651_sigesmancor';
$username = 'if0_38802651';
$password = 'juanarroyo123';

try {
    $pdo = new PDO("mysql:host=$host;dbname=$dbname;charset=utf8", $username, $password);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
    echo "ConexiÃ³n exitosa. Iniciando el seeder...\n";
} catch (PDOException $e) {
    die("Error de conexiÃ³n: " . $e->getMessage());
}

// FunciÃ³n para ejecutar consultas preparadas
function ejecutarConsulta($pdo, $sql, $params = [])
{
    $stmt = $pdo->prepare($sql);
    $stmt->execute($params);
    return $stmt;
}

// FunciÃ³n para obtener el Ãºltimo ID insertado
function ultimoId($pdo)
{
    return $pdo->lastInsertId();
}

// 1. Poblar tabla categorias_equipos (solo si no existen)
echo "Poblando categorias_equipos...\n";
$categorias = [
    ['HemodiÃ¡lisis', 'Equipos para hemodiÃ¡lisis'],
    ['DiagnÃ³stico', 'Equipos para diagnÃ³stico mÃ©dico'],
    ['EsterilizaciÃ³n', 'Equipos para esterilizaciÃ³n'],
    ['Almacenamiento', 'Equipos para almacenamiento'],
    ['Peso', 'Equipos para mediciÃ³n de peso'],
    ['ClimatizaciÃ³n', 'Equipos para control de temperatura y aire'],
    ['OxigenaciÃ³n', 'Equipos para suministro de oxÃ­geno'],
    ['Seguridad', 'Equipos para seguridad y emergencias'],
    ['EnergÃ­a', 'Equipos para gestiÃ³n de energÃ­a'],
    ['Soporte Vital', 'Equipos para soporte vital'],
];

$categoria_ids = [];
foreach ($categorias as $categoria) {
    // Verificar si la categorÃ­a ya existe
    $stmt = ejecutarConsulta($pdo, "SELECT id FROM categorias_equipos WHERE nombre = ?", [$categoria[0]]);
    $result = $stmt->fetch(PDO::FETCH_ASSOC);

    if ($result) {
        // Usar ID existente
        $categoria_ids[$categoria[0]] = $result['id'];
        echo "CategorÃ­a '{$categoria[0]}' ya existe, usando ID {$result['id']}.\n";
    } else {
        // Insertar nueva categorÃ­a
        ejecutarConsulta($pdo, "INSERT INTO categorias_equipos (nombre, descripcion) VALUES (?, ?)", $categoria);
        $categoria_ids[$categoria[0]] = ultimoId($pdo);
        echo "CategorÃ­a '{$categoria[0]}' creada con ID {$categoria_ids[$categoria[0]]}.\n";
    }
}

// 2. Poblar tabla equipos
echo "Poblando equipos...\n";
$equipos = [
    [
        $categoria_ids['HemodiÃ¡lisis'],
        'D-1',
        'MÃ¡quina de HemodiÃ¡lisis',
        'hemodiÃ¡lisis',
        'FRESENIUS',
        '4008S',
        '0SXAlWS8',
        null,
        null,
        null,
        'activo',
        0,
        0,
        null,
        0,
        0,
        0,
        'Purifica la sangre para pacientes con insuficiencia renal',
        null,
        'horas'
    ],
    [
        $categoria_ids['HemodiÃ¡lisis'],
        'D-2',
        'MÃ¡quina de HemodiÃ¡lisis',
        'hemodiÃ¡lisis',
        'NIPRO',
        'DIAMAX',
        'J22936S',
        null,
        null,
        null,
        'activo',
        0,
        0,
        null,
        0,
        0,
        0,
        'Purifica la sangre para pacientes con insuficiencia renal',
        null,
        'horas'
    ],
    [
        $categoria_ids['HemodiÃ¡lisis'],
        'D-7',
        'MÃ¡quina de HemodiÃ¡lisis',
        'hemodiÃ¡lisis',
        'FRESENIUS',
        '4008S',
        null,
        null,
        null,
        null,
        'activo',
        0,
        0,
        null,
        0,
        0,
        0,
        'Purifica la sangre para pacientes con insuficiencia renal',
        null,
        'horas'
    ],
    [
        $categoria_ids['HemodiÃ¡lisis'],
        'D-9',
        'MÃ¡quina de HemodiÃ¡lisis',
        'hemodiÃ¡lisis',
        'FRESENIUS',
        '4008S',
        '1XKA2NS0',
        null,
        null,
        null,
        'activo',
        0,
        0,
        null,
        0,
        0,
        0,
        'Purifica la sangre para pacientes con insuficiencia renal',
        null,
        'horas'
    ],
    [
        $categoria_ids['HemodiÃ¡lisis'],
        'D-9-2',
        'MÃ¡quina de HemodiÃ¡lisis',
        'hemodiÃ¡lisis',
        'FRESENIUS',
        '4008S',
        '1SXA2JHK',
        null,
        null,
        null,
        'activo',
        0,
        0,
        null,
        0,
        0,
        0,
        'Purifica la sangre para pacientes con insuficiencia renal',
        null,
        'horas'
    ],
    [
        $categoria_ids['HemodiÃ¡lisis'],
        'D-11',
        'MÃ¡quina de HemodiÃ¡lisis',
        'hemodiÃ¡lisis',
        'FRESENIUS',
        '4008S',
        'ISXA2PFW',
        null,
        null,
        null,
        'activo',
        0,
        0,
        null,
        0,
        0,
        0,
        'Purifica la sangre para pacientes con insuficiencia renal',
        null,
        'horas'
    ],
    [
        $categoria_ids['HemodiÃ¡lisis'],
        'M-13',
        'MÃ¡quina de HemodiÃ¡lisis',
        'hemodiÃ¡lisis',
        'NIPRO',
        'DIAMAX',
        'J21656S',
        null,
        null,
        null,
        'activo',
        0,
        0,
        null,
        0,
        0,
        0,
        'Purifica la sangre para pacientes con insuficiencia renal',
        null,
        'horas'
    ],
    [
        $categoria_ids['HemodiÃ¡lisis'],
        'MC-13',
        'MÃ¡quina de HemodiÃ¡lisis',
        'hemodiÃ¡lisis',
        'NIPRO',
        'DIAMAX',
        null,
        null,
        null,
        null,
        'activo',
        0,
        0,
        null,
        0,
        0,
        0,
        'Purifica la sangre para pacientes con insuficiencia renal',
        null,
        'horas'
    ],
    [
        $categoria_ids['HemodiÃ¡lisis'],
        'MS-14',
        'MÃ¡quina de HemodiÃ¡lisis',
        'hemodiÃ¡lisis',
        'NIPRO',
        'DIAMAX',
        null,
        null,
        null,
        null,
        'activo',
        0,
        0,
        null,
        0,
        0,
        0,
        'Purifica la sangre para pacientes con insuficiencia renal',
        null,
        'horas'
    ],
    [
        $categoria_ids['DiagnÃ³stico'],
        'BIO-001',
        'Monitor Desfibrilador',
        'desfibrilador',
        'COMEN',
        'S8',
        '58032124015',
        null,
        null,
        null,
        'activo',
        0,
        0,
        null,
        0,
        0,
        0,
        'Diagnostica y restablece el ritmo cardÃ­aco en paros cardÃ­acos',
        null,
        'horas'
    ],
    [
        $categoria_ids['DiagnÃ³stico'],
        'BIO-002',
        'Electrocardiograma',
        'electrocardiograma',
        'EDAN',
        'SE-3',
        '360250-M2550050030',
        null,
        null,
        null,
        'activo',
        0,
        0,
        null,
        0,
        0,
        0,
        'Registra seÃ±ales elÃ©ctricas del corazÃ³n para detectar afecciones cardÃ­acas',
        null,
        'horas'
    ],
    [
        $categoria_ids['Soporte Vital'],
        'BIO-003',
        'Extractor de Fluidos',
        'extractor',
        null,
        null,
        null,
        null,
        null,
        null,
        'activo',
        0,
        0,
        null,
        0,
        0,
        0,
        null,
        null,
        'horas'
    ],
    [
        $categoria_ids['Soporte Vital'],
        'BIO-004',
        'Resucitador Manual',
        'resucitador',
        null,
        null,
        null,
        null,
        null,
        null,
        'activo',
        0,
        0,
        null,
        0,
        0,
        0,
        null,
        null,
        'horas'
    ],
    [
        $categoria_ids['DiagnÃ³stico'],
        'BIO-005',
        'PulsÃ³metro-OxÃ­metro',
        'pulsÃ³metro',
        null,
        null,
        null,
        null,
        null,
        null,
        'activo',
        0,
        0,
        null,
        0,
        0,
        0,
        null,
        null,
        'horas'
    ],
    [
        $categoria_ids['Soporte Vital'],
        'BIO-006',
        'Laringoscopio',
        'laringoscopio',
        null,
        null,
        null,
        null,
        null,
        null,
        'activo',
        0,
        0,
        null,
        0,
        0,
        0,
        null,
        null,
        'horas'
    ],
    [
        $categoria_ids['DiagnÃ³stico'],
        'BIO-007',
        'GlucÃ³metro',
        'glucÃ³metro',
        null,
        null,
        null,
        null,
        null,
        null,
        'activo',
        0,
        0,
        null,
        0,
        0,
        0,
        null,
        null,
        'horas'
    ],
    [
        $categoria_ids['DiagnÃ³stico'],
        'BIO-008',
        'Estetoscopio',
        'estetoscopio',
        'RIESTER',
        '4001-02',
        null,
        null,
        null,
        null,
        'activo',
        0,
        0,
        null,
        0,
        0,
        0,
        'Amplifica ruidos corporales para diagnÃ³stico',
        null,
        'horas'
    ],
    [
        $categoria_ids['DiagnÃ³stico'],
        'BIO-009',
        'TensiÃ³metro Rodante',
        'tensiÃ³metro',
        'RIESTER',
        'Big Ben',
        null,
        null,
        null,
        null,
        'activo',
        0,
        0,
        null,
        0,
        0,
        0,
        'Mide la presiÃ³n arterial',
        null,
        'horas'
    ],
    [
        $categoria_ids['EsterilizaciÃ³n'],
        'BIO-010',
        'Autoclave-Esterilizador Calor HÃºmedo',
        'autoclave',
        'LOVIAP',
        'YX-18LDJ',
        null,
        null,
        null,
        null,
        'activo',
        0,
        0,
        null,
        0,
        0,
        0,
        'Utiliza vapor a presiÃ³n para esterilizar',
        null,
        'horas'
    ],
    [
        $categoria_ids['Almacenamiento'],
        'BIO-011',
        'Refrigeradora',
        'refrigeradora',
        'LG',
        'GT32BPPDC',
        null,
        null,
        null,
        null,
        'activo',
        0,
        0,
        null,
        0,
        0,
        0,
        'EnfrÃ­a y conserva materiales',
        null,
        'horas'
    ],
    [
        $categoria_ids['DiagnÃ³stico'],
        'BIO-012',
        'TermÃ³metro Digital',
        'termÃ³metro',
        'THERMOMETER',
        'SPE-16',
        null,
        null,
        null,
        null,
        'activo',
        0,
        0,
        null,
        0,
        0,
        0,
        'Controla la temperatura de refrigeradoras',
        null,
        'horas'
    ],
    [
        $categoria_ids['Peso'],
        'BIO-013',
        'BÃ¡scula ElectrÃ³nica',
        'bÃ¡scula',
        'REY',
        'LP7553',
        'AC2020082505',
        null,
        null,
        null,
        'activo',
        0,
        0,
        null,
        0,
        0,
        0,
        'Mide el peso corporal con precisiÃ³n',
        null,
        'horas'
    ],
    [
        $categoria_ids['ClimatizaciÃ³n'],
        'BIO-014',
        'Aire Acondicionado',
        'aire acondicionado',
        'YORK',
        'INVERTER',
        null,
        null,
        null,
        null,
        'activo',
        0,
        0,
        null,
        0,
        0,
        0,
        'EnfrÃ­a o calienta el ambiente',
        null,
        'horas'
    ],
    [
        $categoria_ids['ClimatizaciÃ³n'],
        'BIO-015',
        'Inyector/Extractor de Aire',
        'ventilador',
        'ADE/HON&GUAN',
        'HF-315P',
        null,
        null,
        null,
        null,
        'activo',
        0,
        0,
        null,
        0,
        0,
        0,
        'Purifica el aire regulando temperatura y oxÃ­geno',
        null,
        'horas'
    ],
    [
        $categoria_ids['OxigenaciÃ³n'],
        'BIO-016',
        'BalÃ³n de OxÃ­geno Estacionario',
        'oxÃ­geno',
        null,
        '10 m3',
        null,
        null,
        null,
        null,
        'activo',
        0,
        0,
        null,
        0,
        0,
        0,
        'Suministra oxigenoterapia de bajo flujo',
        null,
        'horas'
    ],
    [
        $categoria_ids['OxigenaciÃ³n'],
        'BIO-017',
        'BalÃ³n de OxÃ­geno PortÃ¡til',
        'oxÃ­geno',
        null,
        '10 m3',
        null,
        null,
        null,
        null,
        'activo',
        0,
        0,
        null,
        0,
        0,
        0,
        'Suministra oxigenoterapia de bajo flujo',
        null,
        'horas'
    ],
    [
        $categoria_ids['Seguridad'],
        'BIO-018',
        'Extintor',
        'extintor',
        null,
        'POS-CO2',
        null,
        null,
        null,
        null,
        'activo',
        0,
        0,
        null,
        0,
        0,
        0,
        'Contiene agente extintor para incendios',
        null,
        'horas'
    ],
    [
        $categoria_ids['DiagnÃ³stico'],
        'BIO-019',
        'Reloj e Higro-TermÃ³metro',
        'termÃ³metro',
        'BOEGO',
        'SH-110',
        null,
        null,
        null,
        null,
        'activo',
        0,
        0,
        null,
        0,
        0,
        0,
        'Monitorea temperatura y humedad',
        null,
        'horas'
    ],
    [
        $categoria_ids['Seguridad'],
        'BIO-020',
        'LÃ¡mparas de Emergencia',
        'lÃ¡mpara',
        'OPALUX',
        'Slim Ultrabillante',
        null,
        null,
        null,
        null,
        'activo',
        0,
        0,
        null,
        0,
        0,
        0,
        'Proporciona iluminaciÃ³n en emergencias',
        null,
        'horas'
    ],
    [
        $categoria_ids['EnergÃ­a'],
        'BIO-021',
        'Grupo ElectrÃ³geno',
        'generador',
        null,
        null,
        null,
        null,
        null,
        null,
        'activo',
        0,
        0,
        null,
        0,
        0,
        0,
        null,
        null,
        'horas'
    ],
    [
        $categoria_ids['EnergÃ­a'],
        'BIO-022',
        'Tablero de Transferencia',
        'tablero',
        null,
        null,
        null,
        null,
        null,
        null,
        'activo',
        0,
        0,
        null,
        0,
        0,
        0,
        null,
        null,
        'horas'
    ],
    [
        $categoria_ids['EnergÃ­a'],
        'BIO-023',
        'Sistema ElÃ©ctrico',
        'sistema elÃ©ctrico',
        null,
        null,
        null,
        null,
        null,
        null,
        'activo',
        0,
        0,
        null,
        0,
        0,
        0,
        null,
        null,
        'horas'
    ],
];

foreach ($equipos as $equipo) {
    // Verificar si el equipo ya existe por cÃ³digo
    $stmt = ejecutarConsulta($pdo, "SELECT codigo FROM equipos WHERE codigo = ?", [$equipo[1]]);
    if ($stmt->rowCount() == 0) {
        ejecutarConsulta(
            $pdo,
            "INSERT INTO equipos (categoria_id, codigo, nombre, tipo_equipo, marca, modelo, numero_serie, capacidad, fase, ubicacion, estado, orometro_actual, anterior_orometro, proximo_orometro, limite, notificacion, mantenimiento, observaciones, imagen, tipo_orometro) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)",
            $equipo
        );
        echo "Equipo '{$equipo[2]}' ({$equipo[1]}) insertado.\n";
    } else {
        echo "Equipo con cÃ³digo '{$equipo[1]}' ya existe, omitiendo.\n";
    }
}

echo "\n=== SEEDER COMPLETADO EXITOSAMENTE ===\n";
echo "âœ… CategorÃ­as procesadas: " . count($categorias) . "\n";
echo "âœ… Equipos procesados: " . count($equipos) . "\n";
echo "\nðŸŽ‰ Nuevos equipos biomÃ©dicos agregados a las tablas!\n";
